version: "3.9"

networks:
  private_network:
    driver: bridge
  public_network:
    driver: bridge

services:
  video-capture-service:
    build:
      context: ../../../../src/services/video-capture-service
      dockerfile: Dockerfile
    container_name: video-capture-service
    env_file:
      - ../../../../src/services/video-capture-service/.env
    volumes:
      - /mnt/e/korayzma/images/saved/defects:/images
    depends_on:
      - rabbitmq
    networks:
      - private_network  # Приватная сеть для взаимодействия с RabbitMQ
    restart: unless-stopped

  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq_container
    ports:
     #- "5672:5672"
     - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    healthcheck:
      test: ["CMD", "nc", "-z", "rabbitmq", "5672"]
      interval: 10s
      timeout: 5s
      retries: 3
    networks:
      - private_network  # Приватная сеть для связи с сервисом
      - public_network   # Публичная сеть для доступа к веб-интерфейсу
    restart: unless-stopped